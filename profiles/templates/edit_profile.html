{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Update Profile{% endblock title %}
{% block content %}

<section class="container">
    <div class="card mb-3 mt-3 shadow p-4 mb-5 rounded profile-form">
        <div class="row g-0">
            <div class="col-md-5 col-lg-4">
                {% if user.profile.profile_image.url %}
                <!-- Profile Image -->
                <img class="profile-img rounded border border-secondary border-3 shadow mt-5 w-75 rounded mx-auto d-block mt-3"
                    src="{{ user.profile.profile_image.url  }}" width="100" alt="Profile Image">
                {% else %}
                <!-- Default Image -->
                <img class="profile-img rounded border border-secondary border-3 shadow w-75 mt-5 rounded mx-auto d-block mt-3"
                    src="https://res.cloudinary.com/dpoobzizv/image/upload/v1658586270/default-image_pf4dda.png"
                    width="100" alt="Default Image">
                {% endif %}
            </div>
            <div class="col-md-7 col-lg-8 text-md-start text-center">
                <div class="card-body">
                    <h2 class="mt-2 p-2 text-center">Update Profile</h2>
                    <div class="d-flex justify-content-center">
                        <div class="col-md-6">

                            <!-- Form to update user profile -->
                            <form action="{% url 'update_profile' %}" method="POST"  id="profile-form"
                                enctype="multipart/form-data">
                                {% csrf_token %}
                                {% crispy form form.helper %}
                            </form>
                            <hr>
                            <h2 class="mt-4 text-center">Delete Account</h2>
                            <br>

                            <!-- Form for account deletion -->
                            <form action="{% url 'user_delete' %}" method="post" id="user-delete">
                                {% csrf_token %}
                                <button type="button" class="btn btn-danger" aria-label="Delete my account"
                                    data-bs-toggle="modal" data-bs-target="#modal-confirm-del">Delete my
                                    account</button>
                            </form>
                        </div>

                        <!-- Modal to confirm account deletion -->
                        <div class="modal" id="modal-confirm-del" tabindex="-1">
                            <div class="modal-dialog">
                                <div class="modal-content bkgnd-color-1">
                                    <div class="modal-header">
                                        <h3 class="modal-title">Confirm deletion</h3>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p>Are you sure you want to delete your account?</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                                            aria-label="Cancel deletion">Dismiss</button>
                                        <button type="submit" class="btn btn-danger" aria-label="Confirm deletion"
                                            data-bs-dismiss="modal" form="user-delete">Confirm</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}